name: growx
version: '0.2'
base: core18
summary: Grow your plant and your Business
description: python edge ( psutils, bluepy )
confinement: devmode
grade: stable

    
apps:

  desktop-launch:
    command: bin/desktop-launch
    plugs:
      - desktop

  webserver: 
    command: bin/runserver.sh 
    daemon: simple
    restart-condition: always
    plugs: [network, network-bind, mount-observe, network-observe, system-observe, bluetooth-control]

  growx-daemon: 
    command: bin/run.sh
    daemon: simple
    restart-condition: always
    plugs: [network, network-bind, mount-observe, network-observe, system-observe, bluetooth-control]

    
  
  influxd:
        command: bin/runinfluxd.sh
        plugs: [network, network-bind]
        daemon: simple
        restart-condition: always
        environment:
          INFLUXDB_META_DIR: $SNAP_DATA/meta
          INFLUXDB_DATA_DIR: $SNAP_DATA/data
          INFLUXDB_DATA_WAL_DIR: $SNAP_DATA/wal
          INFLUXDB_CONFIG_PATH: $SNAP_DATA/conf/influxdb.conf
          INFLUXD_BOLT_PATH: $SNAP_DATA/influxdbv2/influxd.bolt
          INFLUXD_ENGINE_PATH: $SNAP_DATA/influxdbv2/engine

  influx:
        command: usr/bin/influx
        plugs: [network, network-bind]
        
  default-client:
        command: bin/defaultclient.sh
        plugs: [network, network-bind]
    
  run: 
    command: bin/run.sh 
    plugs: [network, network-bind, mount-observe, network-observe, system-observe, bluetooth-control]

  info: 
    command: bin/info.sh  
    plugs: [network, network-bind, mount-observe, network-observe, system-observe, bluetooth-control]

parts:


  pymongo-part:
    plugin: python
    python-version: python3
    python-packages: [pymongo]
    build-packages:
      - python3-dev 
      - build-essential
   

  influxdb-part:
    plugin: python
    python-version: python3
    python-packages: [influxdb]
    build-packages:
      - python3-dev
      - build-essential
   

  paho-mqtt-part:
    plugin: python
    python-version: python3
    python-packages: [paho-mqtt]
    build-packages:
      - python3-dev
      - build-essential
      
  flask-part:
    plugin: python
    python-version: python3
    python-packages: [flask]
    build-packages:
      - python3-dev
      - build-essential

  bluepy:
    plugin: python
    python-version: python3
    source: https://github.com/IanHarvey/bluepy
    source-type: git
    build-packages: [libglib2.0-dev]

  miflora:
    plugin: python
    python-version: python3
    python-packages: [miflora]
    build-packages:
      - python3-dev
      - build-essential
      
  influxdb:
        plugin: dump
        source:
         - on amd64: https://dl.influxdata.com/influxdb/releases/influxdb_1.8.3_amd64.deb
         - on arm64: https://dl.influxdata.com/influxdb/releases/influxdb_1.8.3_arm64.deb
        stage-packages:
            - libssl1.1
            - libcurl3-dev
            - libcurl4-openssl-dev

  node-edge-platform:
    plugin: nodejs
    source: .
  
  
  node-code:  
    source: ./node-code/
    plugin: dump
    organize:
      '*': bin/

  


  python-libs:  
    source: ./lib/
    plugin: dump
    organize:
      '*': /lib/python3.6/site-packages/

  python-code:  
    source: ./pythoncode/
    plugin: dump
    organize:
      '*': bin/pythoncode/

  shscripts:  
    source: ./shscripts/
    plugin: dump
    organize:
      '*': bin/

  
  


  
